(()=>{var t={56:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var s={},r=[],a=0;a<t.length;a++){var l=t[a],c=i.base?l[0]+i.base:l[0],h=s[c]||0,d="".concat(c," ").concat(h);s[c]=h+1;var p=n(d),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var g=o(u,i);i.byIndex=a,e.splice(a,0,{identifier:d,updater:g,references:1})}r.push(d)}return r}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var s=i(t=t||[],o=o||{});return function(t){t=t||[];for(var r=0;r<s.length;r++){var a=n(s[r]);e[a].references--}for(var l=i(t,o),c=0;c<s.length;c++){var h=n(s[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}s=l}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},118:()=>{class t extends HTMLElement{connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n      <style>\n        :host{\n          display:block;\n          height: var(--divider-h, 12px);\n          pointer-events: none;\n          background:\n            linear-gradient(to bottom,\n              rgba(255,255,255,.10),\n              rgba(255,255,255,0));\n          box-shadow: inset 0 -1px 0 rgba(255,255,255,.08);\n        }\n      </style>\n      <div aria-hidden="true"></div>\n    '}}customElements.define("buffer-divider",t)},249:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(354),o=n.n(i),s=n(314),r=n.n(s)()(o());r.push([t.id,':root{\n  --bg: #0f1216;\n  --panel: #151a21;\n  --muted: #c8d1dc;\n  --text: #e9eef5;\n  --accent: #6ea8ff;\n  --accent-2: #8bffb0;\n  --border: #273142;\n  --radius: 14px;\n  --shadow: 0 8px 24px rgba(0,0,0,.35);\n  --shadow-soft: 0 2px 8px rgba(0,0,0,.25);\n  --grid-gap: 16px;\n}\n*{box-sizing:border-box}\nhtml,body{height:100%;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}\na,button,[role="button"]{cursor:pointer}\n\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\napp-root {\n  display: block;\n  height: 100%;\n}\n\nmain{\n  display:grid;\n  grid-template-rows: 240px 1fr;\n  gap: var(--grid-gap);\n  height: calc(100% - 64px);\n  padding: var(--grid-gap);\n}\n\n.buffer, .work{\n  background:var(--panel);\n  border:1px solid var(--border);\n  border-radius:var(--radius);\n  box-shadow:var(--shadow-soft);\n  overflow:hidden;\n}\n\n.buffer{height:240px}\n.work{min-height:320px}',"",{version:3,sources:["webpack://./src/styles/main.css"],names:[],mappings:"AAAA;EACE,aAAa;EACb,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,iBAAiB;EACjB,mBAAmB;EACnB,iBAAiB;EACjB,cAAc;EACd,oCAAoC;EACpC,wCAAwC;EACxC,gBAAgB;AAClB;AACA,EAAE,qBAAqB;AACvB,UAAU,WAAW,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,iEAAiE;AAC9H,yBAAyB,cAAc;;;AAGvC;EACE,YAAY;EACZ,SAAS;AACX;;AAEA;EACE,cAAc;EACd,YAAY;AACd;;AAEA;EACE,YAAY;EACZ,6BAA6B;EAC7B,oBAAoB;EACpB,yBAAyB;EACzB,wBAAwB;AAC1B;;AAEA;EACE,uBAAuB;EACvB,8BAA8B;EAC9B,2BAA2B;EAC3B,6BAA6B;EAC7B,eAAe;AACjB;;AAEA,QAAQ,YAAY;AACpB,MAAM,gBAAgB",sourcesContent:[':root{\r\n  --bg: #0f1216;\r\n  --panel: #151a21;\r\n  --muted: #c8d1dc;\r\n  --text: #e9eef5;\r\n  --accent: #6ea8ff;\r\n  --accent-2: #8bffb0;\r\n  --border: #273142;\r\n  --radius: 14px;\r\n  --shadow: 0 8px 24px rgba(0,0,0,.35);\r\n  --shadow-soft: 0 2px 8px rgba(0,0,0,.25);\r\n  --grid-gap: 16px;\r\n}\r\n*{box-sizing:border-box}\r\nhtml,body{height:100%;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}\r\na,button,[role="button"]{cursor:pointer}\r\n\r\n\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\napp-root {\r\n  display: block;\r\n  height: 100%;\r\n}\r\n\r\nmain{\r\n  display:grid;\r\n  grid-template-rows: 240px 1fr;\r\n  gap: var(--grid-gap);\r\n  height: calc(100% - 64px);\r\n  padding: var(--grid-gap);\r\n}\r\n\r\n.buffer, .work{\r\n  background:var(--panel);\r\n  border:1px solid var(--border);\r\n  border-radius:var(--radius);\r\n  box-shadow:var(--shadow-soft);\r\n  overflow:hidden;\r\n}\r\n\r\n.buffer{height:240px}\r\n.work{min-height:320px}'],sourceRoot:""}]);const a=r},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n}).join("")},e.i=function(t,n,i,o,s){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);i&&r[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),e.push(h))}},e}},354:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),s="/*# ".concat(o," */");return[e].concat([s]).join("\n")}return[e].join("\n")}},429:()=>{class t extends HTMLElement{connectedCallback(){this.attachShadow({mode:"open"}),this._polys=[],this._selectedId=null,this.render()}set polygons(t){this._polys=t||[],this.render()}render(){const t=this._polys.map(t=>{const e=t.points.map(t=>`${t.x},${t.y}`).join(" "),n=this._selectedId===String(t.id);return`\n        <svg width="120" height="90" viewBox="0 0 120 90" data-id="${t.id}">\n          ${n?'\n            <defs>\n              <filter id="glow" height="150%" width="150%">\n                <feDropShadow dx="0" dy="0" stdDeviation="6.5" flood-color="orange" flood-opacity="0.9"/>\n              </filter>\n            </defs>':""} \n        <polygon points="${e}" fill="${t.fill}" stroke="${t.stroke}" stroke-width="1" filter="${n?"url(#glow)":""}"/>\n        </svg>\n      `}).join(" ");this.shadowRoot.innerHTML=`\n    <style>\n      :host { \n        display: block; \n        padding: 8px; \n        overflow: auto; \n      }\n\n      div[part="wrap"] { \n        position: relative; \n        display: flex; \n        flex-wrap: wrap;\n      }\n\n      svg { \n        pointer-events: auto;\n        cursor: pointer;\n        margin-right: 2px;\n        margin-bottom: 3px; \n      }\n\n    </style>\n    <div part="wrap">\n      ${t||"<em>Нажмите «Создать»</em>"}\n    </div>\n    `,this.shadowRoot.querySelectorAll("svg").forEach(t=>{t.addEventListener("click",()=>{this._selectedId=String(t.dataset.id),this.render()}),t.addEventListener("mousedown",e=>{const n=this._polys.find(e=>e.id===t.dataset.id),i=this.getRootNode().host.shadowRoot.querySelector("work-zone");if(!i)return;const o=e.clientX,s=e.clientY;let r=!1;const a=t=>{const e=Math.abs(t.clientX-o),c=Math.abs(t.clientY-s);!r&&(e>3||c>3)&&(r=!0,i.startDragFromBuffer(t,n),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l))},l=t=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",l)})})}}customElements.define("buffer-zone",t)},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},659:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},694:()=>{class t extends HTMLElement{connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n      <style>\n        :host, :host * {\n          -webkit-user-select: none;\n          -moz-user-select: none;\n          user-select: none;\n          -webkit-touch-callout: none;\n          -webkit-tap-highlight-color: transparent;\n        }\n\n        button { margin-right: 8px; }\n        select { margin-left: 12px; }\n      </style>\n\n      <button id="create" type="button">Создать</button>\n      <button id="save"   type="button">Сохранить</button>\n      <button id="reset"  type="button">Сбросить</button>\n    \n      <label>\n        Тип:\n        <select id="polyType">\n          <option value="simple" selected>Обычные</option>\n          <option value="convex">Выпуклые</option>\n        </select>\n      </label>\n      ';const t=(t,e={})=>this.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0,composed:!0}));this.shadowRoot.getElementById("create").onclick=()=>{const e=this.shadowRoot.getElementById("polyType").value;t("polys:create",{type:e})},this.shadowRoot.getElementById("save").onclick=()=>t("polys:save"),this.shadowRoot.getElementById("reset").onclick=()=>t("polys:reset")}}customElements.define("controls-bar",t)},800:()=>{class t extends HTMLElement{static LS_KEY="triumph.polys.v1";connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n      <style>\n        :host { \n          display: block; \n          border: none; \n          height: 100%; \n          min-height: 300px;\n          background: #f0f0f0; \n          position: relative;\n          --ruler: 26px;\n          --cell-px: 40;\n          --units-per-cell: 10;\n        }\n\n        canvas {\n          position: absolute;\n          display: block;\n          pointer-events: none;\n        }\n\n        #grid {\n          position: absolute;\n          left: var(--ruler);\n          top: 0;\n          width: calc(100% - var(--ruler));\n          height: calc(100% - var(--ruler));\n          z-index: 0;\n          background: #2b2f36;\n        }\n\n        .ruler-x {\n          position: absolute;\n          left: var(--ruler);\n          bottom: 0;\n          width: calc(100% - var(--ruler));\n          height: var(--ruler);\n          z-index: 5;\n          background: #4b4f56;\n        }\n\n        .ruler-y {\n          position: absolute;\n          left: 0;\n          top: 0;\n          width: var(--ruler);\n          height: calc(100% - var(--ruler));\n          z-index: 5;\n          background: #4b4f56;\n        }\n\n        .corner {\n          position: absolute; \n          left: 0; \n          bottom: 0; \n          width: var(--ruler);\n          height: var(--ruler);\n          background: #4b4f56; \n          z-index: 5;\n          pointer-events: none;\n        }\n\n        #scene { \n          position: absolute; \n          left: 0;\n          top: 0;\n          width: 100%; \n          height: calc(100% - var(--ruler));\n          z-index: 2; \n          pointer-events: none;\n        }\n        \n        svg { \n          position: absolute; \n          top: 0; \n          left: 0; \n          cursor: grab; \n          z-index: 3; \n          transform: translateZ(0);\n          will-change: left, top;\n          pointer-events: none;\n          transform-origin: top left;\n        }\n\n        #interaction-layer {\n          position: absolute;\n          left: var(--ruler);\n          top: 0;\n          width: calc(100% - var(--ruler));\n          height: calc(100% - var(--ruler));\n          z-index: 4; \n          cursor: grab;\n        }\n      </style>\n\n      <canvas id="grid"></canvas>\n      <div id="scene"></div>\n      <div id="interaction-layer"></div>\n      <canvas class="ruler-x"></canvas>\n      <canvas class="ruler-y"></canvas>\n      <canvas class="corner" id="corner"></canvas>\n    ',this.$grid=this.shadowRoot.getElementById("grid"),this.$scene=this.shadowRoot.getElementById("scene"),this.$rx=this.shadowRoot.querySelector(".ruler-x"),this.$ry=this.shadowRoot.querySelector(".ruler-y"),this.$corner=this.shadowRoot.getElementById("corner"),this.$interaction=this.shadowRoot.getElementById("interaction-layer");const t=getComputedStyle(this);this._baseCell=parseFloat(t.getPropertyValue("--cell-px"))||40,this._baseUnits=parseFloat(t.getPropertyValue("--units-per-cell"))||10,this._ppuBase=this._baseCell/this._baseUnits,this._scale=1,this._minScale=.25,this._maxScale=20,this._panX=0,this._panY=0,this._yMaxUnits=550,this._xMaxUnits=1700,this._niceStep=(t,e=this._baseCell)=>{const n=e/t,i=Math.pow(10,Math.floor(Math.log10(n))),o=n/i;let s;return s=o<1.5?1:o<3.5?2:o<7.5?5:10,s*i},this._updateAllPolys=()=>{this.$scene.querySelectorAll("svg").forEach(t=>{this._updateSvgAppearance(t)})},this._onPointerDown=this._onPointerDown.bind(this),this.$interaction.addEventListener("mousedown",this._onPointerDown),this._onWheel=this._onWheel.bind(this),this.addEventListener("wheel",this._onWheel,{passive:!1});const e=new ResizeObserver(()=>this.layoutAndDraw());e.observe(this),this._ro=e,requestAnimationFrame(()=>{this.layoutAndDraw(),this._loadFromStorage()})}disconnectedCallback(){this._ro?.disconnect(),this.removeEventListener("wheel",this._onWheel),this.$interaction?.removeEventListener("mousedown",this._onPointerDown)}exportPolygons(){const t=[];return this.$scene.querySelectorAll("svg").forEach(e=>{const n=e.querySelector("polygon");if(!n)return;const i=(n.getAttribute("points")||"").match(/-?[\d.]+/g)||[],o=[];for(let t=0;t<i.length;t+=2)if(void 0!==i[t+1]){const e=parseFloat(i[t]),n=parseFloat(i[t+1]);Number.isFinite(e)&&Number.isFinite(n)&&o.push({x:e,y:n})}t.push({points:o,fill:n.getAttribute("fill")||"#ccc",stroke:n.getAttribute("stroke")||"#333",xUnits:+e.dataset.xUnits,yUnits:+e.dataset.yUnits,baseWidth:+e.dataset.baseWidth||120,baseHeight:+e.dataset.baseHeight||90})}),t}importPolygons(t=[],{clear:e=!0}={}){e&&this.clearPolygons();for(const e of t){const t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg"),i=e.baseWidth??120,o=e.baseHeight??90;n.setAttribute("width",i),n.setAttribute("height",o),n.setAttribute("viewBox",`0 0 ${i} ${o}`),n.dataset.baseWidth=i,n.dataset.baseHeight=o;const s=document.createElementNS(t,"polygon");s.setAttribute("points",e.points.map(t=>`${t.x}, ${t.y}`).join(" ")),s.setAttribute("fill",e.fill),s.setAttribute("stroke",e.stroke),s.setAttribute("stroke-width",1),s.setAttribute("vector-effect","non-scaling-stroke"),s.style.pointerEvents="auto",n.appendChild(s),this.$scene.appendChild(n),n.dataset.xUnits=String(e.xUnits??0),n.dataset.yUnits=String(e.yUnits??0),this._updateSvgAppearance(n)}this._applyVisibilityByBounds()}clearPolygons(){this.$scene.querySelectorAll("svg").forEach(t=>t.remove())}save(){try{const t=this.exportPolygons();return localStorage.setItem(this.constructor.LS_KEY,JSON.stringify(t)),console.info("Polygons saved:",t.length),!0}catch(t){return console.error("Save failed",t),!1}}reset(){try{return localStorage.removeItem(this.constructor.LS_KEY),this.clearPolygons(),console.info("Polygons reset"),!0}catch(t){return console.error("Reset failed",t),!1}}addPolygon(t,e,n){const i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg");o.setAttribute("width",120),o.setAttribute("height",90),o.setAttribute("viewBox","0 0 120 90"),o.dataset.baseWidth=120,o.dataset.baseHeight=90;const s=document.createElementNS(i,"polygon");s.setAttribute("points",t.points.map(t=>`${t.x}, ${t.y}`).join(" ")),s.setAttribute("fill",t.fill),s.setAttribute("stroke",t.stroke),s.setAttribute("stroke-width",1),s.setAttribute("vector-effect","non-scaling-stroke"),s.style.pointerEvents="auto",o.appendChild(s),this.$scene.appendChild(o);const r=e/this._scale-60,a=n/this._scale-45,{GL:l,GH:c}=this._gridLogical(),h=(r-l-this._panX)/this._ppuBase,d=(c-(a-this._panY))/this._ppuBase;return o.dataset.xUnits=String(h),o.dataset.yUnits=String(d),this._updateSvgAppearance(o),o}startDrag(t,e){t.preventDefault(),t.stopPropagation(),this.$interaction.style.cursor="grabbing";const n=this.getBoundingClientRect(),i=e.getBoundingClientRect(),o=(t.clientX-i.left)/this._scale,s=(t.clientY-i.top)/this._scale,r=t=>{const i=(t.clientX-n.left)/this._scale-o,r=(t.clientY-n.top)/this._scale-s,{LEFT_MIN:a,LEFT_MAX:l,TOP_MIN:c,TOP_MAX:h}=this._gridBoundsLogicalFor(e),d=this._clamp(i,a,l),p=this._clamp(r,c,h),{GL:u,GH:g}=this._gridLogical();e.dataset.xUnits=String((d-u-this._panX)/this._ppuBase),e.dataset.yUnits=String((g-(p-this._panY))/this._ppuBase),this._updateSvgAppearance(e)},a=()=>{this.$interaction.style.cursor="grab",window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",a)};window.addEventListener("mousemove",r),window.addEventListener("mouseup",a)}startDragFromBuffer(t,e){t.preventDefault();const n=this.getBoundingClientRect(),i=this.addPolygon(e,t.clientX-n.left,t.clientY-n.top),o=i.getBoundingClientRect(),s=(t.clientX-o.left)/this._scale,r=(t.clientY-o.top)/this._scale,a=this.$grid.getBoundingClientRect(),l=(a.left-n.left)/this._scale,c=(a.top-n.top)/this._scale,h=l+a.width/this._scale,d=c+a.height/this._scale,p=i.querySelector("polygon").getBBox(),u=this.getRootNode()?.querySelector("buffer-zone"),g=u?.getBoundingClientRect(),f=g?(g.top-n.top)/this._scale:0,y=h-(p.x+p.width),m=d-(p.y+p.height),v=f-p.y,b=l-p.x,x=t=>{let e=(t.clientX-n.left)/this._scale-s,o=(t.clientY-n.top)/this._scale-r;e<b&&(e=b),e>y&&(e=y),o<v&&(o=v),o>m&&(o=m),i.style.left=e*this._scale+"px",i.style.top=o*this._scale+"px";const{GL:a,GH:l}=this._gridLogical();i.dataset.xUnits=String((e-a-this._panX)/this._ppuBase),i.dataset.yUnits=String((l-(o-this._panY))/this._ppuBase)},A=()=>{const t=this.getBoundingClientRect(),e=i.getBoundingClientRect(),n=i.querySelector("polygon").getBoundingClientRect(),o=this.getRootNode()?.querySelector("buffer-divider"),s=o?o.getBoundingClientRect().height:0,r=n.top-t.top;if(r<-s)i.remove();else if(r<0){const t=0-(n.top-e.top),o=Math.round(t);i.style.top=`${o}px`;const s=o/this._scale,{GH:r}=this._gridLogical();i.dataset.yUnits=String((r-(s-this._panY))/this._ppuBase)}window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",A)};window.addEventListener("mousemove",x),window.addEventListener("mouseup",A)}_onPointerDown(t){if(0!==t.button)return;this.$interaction.style.pointerEvents="none";const e=this.shadowRoot.elementFromPoint(t.clientX,t.clientY);this.$interaction.style.pointerEvents="auto";const n=e?.closest("svg");n?this.startDrag(t,n):this._onPanStart(t)}_onPanStart(t){this.$interaction.style.cursor="grabbing",t.preventDefault();const e=t.clientX,n=t.clientY,i=this._panX,o=this._panY,{GW:s,GH:r}=this._gridLogical(),a=t=>{const a=(t.clientX-e)/this._scale,l=(t.clientY-n)/this._scale;this._panX=this._clamp(i+a,-Math.max(0,this._xMaxPx()-s),0),this._panY=this._clamp(o+l,0,Math.max(0,this._yMaxPx()-r)),this.drawGrid(),this.drawRulerX(),this.drawRulerY(),this._updateAllPolys(),this._applyVisibilityByBounds()},l=()=>{this.$interaction.style.cursor="grab",window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",l)};window.addEventListener("mousemove",a),window.addEventListener("mouseup",l)}_onWheel(t){t.preventDefault();const e=t.deltaY<0?1:-1,n=this._scale,i=this._clamp(n*(1+.1*e),this._minScale,this._maxScale);if(Math.abs(i-n)<1e-5)return;const o=this.getBoundingClientRect(),s=t.clientX-o.left,r=t.clientY-o.top,{GL:a,GH:l}=this._gridLogical(),c=s/n-a-this._panX,h=l-(r/n-this._panY);this._scale=i;const{GL:d,GH:p,GW:u}=this._gridLogical(),g=s/i-d-c,f=r/i-p+h,y=-Math.max(0,this._xMaxPx()-u),m=Math.max(0,this._yMaxPx()-p);this._panX=this._clamp(g,y,0),this._panY=this._clamp(f,0,m);const v=this._ppuBase*this._scale,b=this._niceStep(v,this._baseCell),x=b*v;this.style.setProperty("--units-per-cell",String(b)),this.style.setProperty("--cell-px",String(+x.toFixed(4))),this.layoutAndDraw(),this._updateAllPolys(),this._applyVisibilityByBounds()}_loadFromStorage(){try{const t=localStorage.getItem(this.constructor.LS_KEY);if(!t)return;const e=JSON.parse(t);Array.isArray(e)&&this.importPolygons(e,{clear:!0})}catch(t){console.warn("Failed to load saved polygons:",t)}}layoutAndDraw(){const t=Math.max(1,window.devicePixelRatio||1);this.$grid.style.top="0px",this.$grid.style.height="calc(100% - var(--ruler))",this.$ry.style.top="0px",this.$ry.style.height="calc(100% - var(--ruler))";const e=e=>{const n=e.getBoundingClientRect(),i=e.getContext("2d");return e.width=Math.max(1,Math.floor(n.width*t)),e.height=Math.max(1,Math.floor(n.height*t)),i.setTransform(t,0,0,t,0,0),i};this._ctxGrid=e(this.$grid),this._ctxX=e(this.$rx),this._ctxY=e(this.$ry),this._ctxCorner=e(this.$corner),this.drawGrid(),this.drawRulerX(),this.drawRulerY(),this.drawCorner(),this._updateAllPolys(),this._applyVisibilityByBounds()}drawCorner(){const t=this._ctxCorner,e=this.$corner.getBoundingClientRect(),n=e.width,i=e.height;t.fillStyle="#e1e3e6",t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("0",n/2,i/2)}drawGrid(){const t=this._ctxGrid,e=this.$grid.getBoundingClientRect(),n=e.width,i=e.height,o=parseFloat(getComputedStyle(this).getPropertyValue("--cell-px"))||40,s=parseFloat(getComputedStyle(this).getPropertyValue("--units-per-cell"))||this._baseUnits;t.fillStyle="#2b2f36",t.fillRect(0,0,n,i);const r=this._panX*this._scale,a=(r%o+o)%o,l=Math.floor(-r/o),c=Math.floor(this._xMaxUnits/s);for(let e=0;;e++){const s=Math.floor(e*o+a)+.5;if(s<-.5)continue;if(s>n+.5)break;const r=l+e;if(!(r<0)){if(r>c)break;t.beginPath(),t.lineWidth=r%5==0?1.2:1,t.strokeStyle=r%5==0?"rgba(255,255,255,.18)":"rgba(255,255,255,.10)",t.moveTo(s,0),t.lineTo(s,i),t.stroke()}}const h=this._panY*this._scale,d=(h%o+o)%o,p=Math.floor(h/o),u=Math.floor(this._yMaxUnits/s);for(let e=0;;e++){const s=Math.floor(i-(e*o-d))+.5;if(s<-.5)break;if(s>i+.5)continue;const r=p+e;if(!(r<0)){if(r>u)break;t.beginPath(),t.lineWidth=r%5==0?1.2:1,t.strokeStyle=r%5==0?"rgba(255,255,255,.18)":"rgba(255,255,255,.10)",t.moveTo(0,s),t.lineTo(n,s),t.stroke()}}}drawRulerX(){const t=this._ctxX,e=this.$rx.getBoundingClientRect(),n=e.width,i=e.height,o=parseFloat(getComputedStyle(this).getPropertyValue("--units-per-cell"))||this._baseUnits,s=this._ppuBase*this._scale,r=-this._panX*this._scale/s,a=r+n/s;t.clearRect(0,0,n,i),t.fillStyle="#4b4f56",t.fillRect(0,0,n,i),t.fillStyle="#e1e3e6",t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial",t.textAlign="center",t.textBaseline="middle";let l=Math.ceil(r/o)*o;const c=parseFloat(getComputedStyle(this).getPropertyValue("--ruler"))||26;for(;l<=a+1e-9;){const e=Math.round((l-r)*s)+.5;if(Math.abs(l)<1e-9&&e<c+8){l+=o;continue}const a=String(l),{w:h,h:d}=this._metrics(t,a);this._fitsHorizCenter(e,h,n,1)&&this._fitsVertMiddle(i/2,d,i,1,1)&&t.fillText(a,e,i/2),l+=o}}drawRulerY(){const t=this._ctxY,e=this.$ry.getBoundingClientRect().width,n=this.$ry.getBoundingClientRect().height,i=parseFloat(getComputedStyle(this).getPropertyValue("--cell-px"))||40,o=parseFloat(getComputedStyle(this).getPropertyValue("--units-per-cell"))||10;t.clearRect(0,0,e,n),t.fillStyle="#4b4f56",t.fillRect(0,0,e,n),t.fillStyle="#e1e3e6",t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial",t.textAlign="left",t.textBaseline="middle";const s=this._panY*this._scale,r=(s%i+i)%i,a=Math.floor(s/i),l=Math.floor(this._yMaxUnits/o);for(let s=0;;s++){const c=Math.floor(n-(s*i-r))+.5;if(c<-.5)break;const h=a+s;if(h<0)continue;if(h>l)break;const d=String(h*o),{w:p,h:u}=this._metrics(t,d);this._fitsHorizLeft(4,p,e,4,2)&&this._fitsVertMiddle(c,u,n,1,1)&&t.fillText(d,4,c)}}_updateSvgAppearance(t){const e=parseFloat(t.dataset.xUnits??"NaN"),n=parseFloat(t.dataset.yUnits??"NaN");if(!Number.isFinite(e)||!Number.isFinite(n))return;const i=parseFloat(t.dataset.baseWidth),o=parseFloat(t.dataset.baseHeight),s=i*this._scale,r=o*this._scale;t.setAttribute("width",s),t.setAttribute("height",r);const{GL:a,GH:l}=this._gridLogical(),c=a+e*this._ppuBase+this._panX,h=l-n*this._ppuBase+this._panY;t.style.left=`${Math.round(c*this._scale)}px`,t.style.top=`${Math.round(h*this._scale)}px`}_applyVisibilityByBounds(){const t=this.getBoundingClientRect(),e=this.$grid.getBoundingClientRect(),n=e.left-t.left,i=e.top-t.top,o=n+e.width,s=i+e.height;this.$scene.querySelectorAll("svg").forEach(e=>{const r=e.getBoundingClientRect(),a=r.left-t.left,l=r.top-t.top,c=a+r.width,h=l+r.height;if(!(a<o&&c>n&&l<s&&h>i))return e.style.visibility="hidden",void(e.style.clipPath="");e.style.visibility="visible";const d=Math.max(0,i-l),p=Math.max(0,h-s),u=Math.max(0,n-a),g=Math.max(0,c-o);e.style.clipPath=d>.5||p>.5||u>.5||g>.5?`inset(${d}px ${g}px ${p}px ${u}px)`:""})}_gridLogical(){const t=this.getBoundingClientRect(),e=this.$grid.getBoundingClientRect(),n=(e.left-t.left)/this._scale,i=(e.top-t.top)/this._scale,o=e.width/this._scale,s=e.height/this._scale;return{GL:n,GT:i,GR:n+o,GB:i+s,GW:o,GH:s}}_yMaxPx(){return this._yMaxUnits*this._ppuBase}_xMaxPx(){return this._xMaxUnits*this._ppuBase}_clamp(t,e,n){return t<e?e:t>n?n:t}_metrics(t,e){const n=t.measureText(e),i=n.actualBoundingBoxAscent??8,o=n.actualBoundingBoxDescent??3;return{w:n.width??0,h:i+o}}_fitsVertMiddle(t,e,n,i=1,o=1){return t-e/2>=i&&t+e/2<=n-o}_fitsHorizCenter(t,e,n,i=1){return t-e/2>=i&&t+e/2<=n-i}_fitsHorizLeft(t,e,n,i=4,o=2){return t>=i&&t+e<=n-o}_gridBoundsLogicalFor(t){const{GL:e,GR:n,GH:i}=this._gridLogical(),o=i,s=Math.min(n,this._xMaxPx()+e),r=t.querySelector("polygon").getBBox();return{LEFT_MIN:e-r.x,LEFT_MAX:s-(r.x+r.width),TOP_MIN:0-r.y,TOP_MAX:o-(r.y+r.height)}}}customElements.define("work-zone",t)},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var s=e[i]={id:i,exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{"use strict";var t=n(72),e=n.n(t),i=n(825),o=n.n(i),s=n(659),r=n.n(s),a=n(56),l=n.n(a),c=n(540),h=n.n(c),d=n(113),p=n.n(d),u=n(249),g={};g.styleTagTransform=p(),g.setAttributes=l(),g.insert=r().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=h(),e()(u.A,g),u.A&&u.A.locals&&u.A.locals,n(694),n(429),n(800),n(118);const f={buffer:[],work:[]},y=(t,e)=>t+Math.floor(Math.random()*(e-t+1));function m(t,e=120,n=90,i=4){const o=t.map(t=>t.x),s=t.map(t=>t.y),r=Math.min(...o),a=Math.max(...o),l=Math.min(...s),c=(e-2*i)/(a-r||1),h=(n-2*i)/(Math.max(...s)-l||1),d=Math.min(c,h),p=i-r*d,u=i-l*d;return t.map(t=>({x:t.x*d+p,y:t.y*d+u}))}function v(t,e,n,i){const o=(t,e,n)=>(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),s=o(t,e,n),r=o(t,e,i),a=o(n,i,t),l=o(n,i,e);return s*r<0&&a*l<0}function b(t){const e=t.length;for(let n=0;n<e;n++){const i=t[n],o=t[(n+1)%e];for(let s=n+1;s<e;s++)if(!(Math.abs(n-s)<=1||0===n&&s===e-1||n===e-1&&0===s)&&v(i,o,t[s],t[(s+1)%e]))return!1}return!0}function x(t){const e=t.length;if(e<3)return!1;let n=0;for(let i=0;i<e;i++){const o=t[i],s=t[(i+1)%e],r=t[(i+2)%e],a=(s.x-o.x)*(r.y-s.y)-(s.y-o.y)*(r.x-s.x);if(Math.abs(a)>1e-8){const t=Math.sign(a);if(0===n)n=t;else if(t!==n)return!1}}return console.log("gh"),!0}function A(t,e=15){const n=t.length;for(let i=0;i<n;i++){const o=t[i],s=t[(i+1)%n],r=t[(i+2)%n],a={x:s.x-o.x,y:s.y-o.y},l={x:r.x-s.x,y:r.y-s.y},c=(a.x*l.x+a.y*l.y)/(Math.hypot(a.x,a.y)*Math.hypot(l.x,l.y));if(180*Math.acos(Math.min(Math.max(c,-1),1))/Math.PI<e)return!1}return!0}function _(t,e=25){const n=t.length;for(let i=0;i<n;i++){const o=t[i],s=t[(i+1)%n];if(Math.hypot(s.x-o.x,s.y-o.y)<e)return!1}return!0}function w(){const t=y(3,8);let e;do{e=Array.from({length:t},()=>2*Math.random()*Math.PI).sort((t,e)=>t-e).map(t=>{const e=25+25*Math.random();return{x:e*Math.cos(t),y:e*Math.sin(t)}})}while(!b(e)||!A(e)||!_(e));e=m(e,120,90,8);const n=y(0,360);return{id:`p_${crypto.randomUUID?.()||Date.now()+" "+Math.random()}`,points:e,fill:`hsl(${n} 70% 55%)`,stroke:"rgba(0,0,0.25)"}}function B(){let t;const e=y(3,8);do{t=[];let n=2*Math.PI/e;for(let i=0;i<e;i++){const e=i*n+(Math.random()-.5)*n*.5,o=25+20*Math.random()*.25;t.push({x:o*Math.cos(e),y:o*Math.sin(e)})}}while(!x(t)||!b(t));t=m(t,120,90,8);const n=y(0,360);return{id:`p_${crypto.randomUUID?.()||Date.now()+" "+Math.random()}`,points:t,fill:`hsl(${n} 70% 55%)`,stroke:"rgba(0,0,0.25)"}}class E extends HTMLElement{connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n      <style>\n        :host { \n          display: grid;\n          grid-template-rows: auto 1fr;\n          height: 100vh;\n          min-height: 0;\n          --header-h: 0px;\n          --divider-h: 12px;\n        }\n\n        header { \n          padding: 12px 16px;\n          border-bottom: 1px solid var(--border, #2b3342);\n          background: linear-gradient(0deg, var(--panel, #151a21), #11161f);\n          color: var(--text, #e9eef5);\n          user-select: none;\n        }\n       \n        main { \n          display: grid;\n          grid-template-rows: 220px var(--divider-h) 1fr; \n          height: calc(100% - var(--header-h));\n          border: none;\n          background: var(--bg, #0f1216);\n          position: relative;\n          min-height: 0;\n          overflow: hidden;\n        }\n       \n        .buffer{\n          position: relative;\n          background: var(--panel, #151a21);\n        }\n\n        .work{\n          position: relative;\n          background: var(--panel, #151a21);\n          min-height: 0;\n        }\n          \n      </style>\n      <header><strong>Triumph</strong> · <controls-bar></controls-bar></header>\n      <main>\n        <buffer-zone class="buffer"></buffer-zone>\n        <buffer-divider></buffer-divider>\n        <work-zone class="work"></work-zone>\n      </main>\n    ';const t=this.shadowRoot.querySelector("header");this._setHeaderHeight=()=>{const e=Math.ceil(t.getBoundingClientRect().height);this.style.setProperty("--header-h",`${e}px`)},this._setHeaderHeight(),this._headerRO=new ResizeObserver(this._setHeaderHeight),this._headerRO.observe(t),window.addEventListener("resize",this._setHeaderHeight),this.addEventListener("polys:create",t=>{let e;var n;e="convex"===t.detail.type?Array.from({length:y(5,20)},B):Array.from({length:y(5,20)},w),n=e,f.buffer=n,this.shadowRoot.querySelector("buffer-zone").polygons=f.buffer}),this.addEventListener("polys:save",()=>{console.log("polys:save event received");const t=this.shadowRoot.querySelector("work-zone");t?t.save():console.error("work-zone element not found")}),this.addEventListener("polys:reset",()=>{const t=this.shadowRoot.querySelector("work-zone");t?.reset()})}}customElements.define("app-root",E)})()})();
//# sourceMappingURL=main.6153248b.js.map