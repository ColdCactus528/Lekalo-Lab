# Lekalo-Lav

Инструмент для раскладки полигональных «выкроек» на сетке: генерация деталей, перетаскивание из буфера на рабочую область, масштаб и панорамирование, линейки и сохранение состояния в `localStorage`. Построен на **Web Components** без фреймворков. Попробовать сами можете по ссылке ( https://coldcactus528.github.io/Lekalo-Lab/ )

## Демо (как это работает)
- Вверху — панель управления: «Создать», «Сохранить», «Сбросить» и выбор типа полигонов.
- Сгенерированные полигоны появляются в **буфере** (верхняя панель).
- Перетащи полигон из буфера в **рабочую зону** (нижняя панель).
- Крути колесо мыши, чтобы **масштабировать** (зум к курсору), зажимай ЛКМ по пустому месту — **перемещай** сцену.
- Нажми **Сохранить**, чтобы записать текущую сцену в `localStorage`. **Сбросить** очистит сохранённое и сцену.

## Возможности
- Сетка с «умным» шагом и **линейки** по краям (динамическая разметка).
- **Зум к курсору** и **панорамирование** с ограничениями по краям.
- Буфер деталей (палитра) и **drag & drop** на рабочую область.
- **Обрезка (clip)** SVG вне видимой области для производительности.
- **Сохранение/загрузка** сцены в `localStorage`.
- Публичный API: импорт/экспорт полигонов.

## Скрипты

```bash
# разработка (HMR + source maps)
npm run dev

# прод-сборка в папку dist
npm run build

# локальный предпросмотр собранного dist
# вариант 1: если установлен serve как devDep
npm run preview
# вариант 2: без установки – через npx
npx serve -s dist
```

> Требуется Node.js 18+ (рекомендация).

## Стек и архитектура

- **Web Components**: собственные элементы без фреймворков.
- **Canvas 2D** для сетки и линеек; **SVG** для самих полигонов.
- **Webpack 5** для сборки.

### Основные компоненты

- `AppRoot` — корневой слой приложения: верстка, шина событий, связка буфера и рабочей зоны.
- `ControlsBar` — панель действий (создание/сохранение/сброс + тип полигонов).
- `BufferZone` — буфер/палитра сгенерированных полигонов, выбор и перетаскивание.
- `WorkZone` — рабочая область с сеткой/линейками, зумом/панорамированием и размещением SVG.

### События (межкомпонентное взаимодействие)

`ControlsBar` диспатчит кастомные события (всплывают до `AppRoot`):

- `polys:create` `{ type: "simple" | "convex" }` — сгенерировать набор.
- `polys:save` — сохранить текущую сцену.
- `polys:reset` — сбросить сцену и localStorage.

`WorkZone` имеет публичные методы:
- `exportPolygons(): PolygonDTO[]`
- `importPolygons(list: PolygonDTO[], { clear = true } = {})`
- `save()` / `reset()`
- `startDragFromBuffer(event, polygonDTO)` — используется `BufferZone` при d&d.

### Формат данных полигона (DTO)

```ts
type Point = { x: number; y: number };

type PolygonDTO = {
  id?: string;            // используется в BufferZone для выделения
  points: Point[];        // координаты в системе viewBox (например 120x90)
  fill: string;           // цвет заливки, напр. "#ccc"
  stroke: string;         // цвет обводки, напр. "#333"
  // ниже — для WorkZone (позиция/базовые размеры)
  xUnits?: number;        // положение по X в "единицах" сетки
  yUnits?: number;        // положение по Y в "единицах" сетки
  baseWidth?: number;     // ширина SVG-блока в базовой системе (по умолчанию 120)
  baseHeight?: number;    // высота SVG-блока (по умолчанию 90)
};
```

## Структура проекта

```
project/
├─ public/
│  └─ index.html            # HTML-шаблон (подхватывает HtmlWebpackPlugin)
├─ src/
│  ├─ components/
│  │  ├─ app-root.js        # корневой компонент
│  │  ├─ controls-bar.js    # панель управления
│  │  ├─ buffer-zone.js     # буфер полигонов
│  │  ├─ work-zone.js       # рабочая зона (сетка/линейки/сцена)
│  │  └─ buffer-divider.js  # разделитель между буфером и сценой
│  ├─ styles/
│  │  └─ main.css           # базовые стили (импортируются в index.js)
│  ├─ utils/
│  │  └─ polygen.js         # генераторы simple/convex полигонов
│  ├─ store.js              # простой стор + setBuffer()
│  └─ index.js              # точка входа, регистрирует компоненты/стили
├─ webpack.config.js
├─ package.json
└─ README.md
```
